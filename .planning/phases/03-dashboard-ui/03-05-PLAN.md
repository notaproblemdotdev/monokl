---
phase: 03-dashboard-ui
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - src/monocli/adapters/jira.py
  - src/monocli/ui/main_screen.py
autonomous: true
gap_closure: true
must_haves:
  truths:
    - "CLI authentication check uses valid command"
    - "acli auth check uses 'jira auth status' instead of non-existent 'whoami'"
  artifacts:
    - path: "src/monocli/adapters/jira.py"
      provides: "JiraAdapter.check_auth() using valid acli command"
      changes:
        - "Line 94: Replace ['whoami'] with ['jira', 'auth', 'status']"
    - path: "src/monocli/ui/main_screen.py"
      provides: "CLIDetector registration with valid acli auth command"
      changes:
        - "Line 124: Replace ['whoami'] with ['jira', 'auth', 'status']"
  key_links:
    - from: "CLIDetector('acli', ['jira', 'auth', 'status'])"
      to: "JiraAdapter.check_auth()"
      via: "Both use same acli auth command"
---

# Gap Closure Plan 05: Fix acli Auth Check Command

## Objective
Replace the invalid `acli whoami` command with the valid `acli jira auth status` command for authentication checking.

**Purpose:** The `acli whoami` command doesn't exist in acli, causing the Jira adapter to always fail auth checks. The correct command is `acli jira auth status`.

**Output:** Updated `jira.py` and `main_screen.py` using the correct acli auth command.

## Execution Context
@/.planning/ROADMAP.md
@/.planning/STATE.md
@/.planning/phases/03-dashboard-ui/03-dashboard-ui-UAT.md

## Context

**Gap Being Closed:**
- Gap 3: CLI authentication check uses valid command

**Root Cause:** The code assumes `acli whoami` is a valid command, but acli doesn't have this command. Should use `acli jira auth status` instead.

**Files to Modify:**
- `src/monocli/adapters/jira.py` - Line 94 (check_auth method)
- `src/monocli/ui/main_screen.py` - Line 124 (CLIDetector registration)

**Command Change:**
- OLD: `acli whoami` (invalid, returns "unknown command")
- NEW: `acli jira auth status` (valid auth check command)

## Tasks

<task type="auto">
  <name>Fix acli auth check command in JiraAdapter</name>
  <files>src/monocli/adapters/jira.py</files>
  <action>
Update the check_auth() method in JiraAdapter to use the correct acli command:

File: src/monocli/adapters/jira.py
Line 94: Change from:
  await self.run(["whoami"], check=True)
To:
  await self.run(["jira", "auth", "status"], check=True)

This aligns with the pattern used for glab auth check which uses ["auth", "status"].
The acli command structure is: acli jira auth status

Update the docstring on line 79 to reflect the new command:
OLD: "Runs acli whoami to verify authentication"
NEW: "Runs acli jira auth status to verify authentication"
  </action>
  <verify>
Run the adapter tests:
```bash
uv run pytest tests/adapters/test_jira.py -v -x
```

Verify syntax:
```bash
uv run ruff check src/monocli/adapters/jira.py
```
  </verify>
  <done>
- Line 94 uses `["jira", "auth", "status"]` instead of `["whoami"]`
- Docstring updated to reflect new command
- Adapter tests pass
  </done>
</task>

<task type="auto">
  <name>Fix acli auth command in CLIDetector registration</name>
  <files>src/monocli/ui/main_screen.py</files>
  <action>
Update the CLIDetector registration for acli to use the correct auth command:

File: src/monocli/ui/main_screen.py
Line 124: Change from:
  registry.register(CLIDetector("acli", ["whoami"]))
To:
  registry.register(CLIDetector("acli", ["jira", "auth", "status"]))

This ensures the CLIDetector uses the same command as JiraAdapter.check_auth() for consistency.
  </action>
  <verify>
Run the UI tests:
```bash
uv run pytest tests/ui/test_main_screen.py -v -x
```

Verify syntax:
```bash
uv run ruff check src/monocli/ui/main_screen.py
```
  </verify>
  <done>
- Line 124 uses `["jira", "auth", "status"]` for CLIDetector
- Consistent with JiraAdapter.check_auth() command
- UI tests pass
  </done>
</task>

## Verification

After completing this plan:
- [ ] `jira.py` line 94 uses `["jira", "auth", "status"]`
- [ ] `main_screen.py` line 124 uses `["jira", "auth", "status"]` for CLIDetector
- [ ] Both files pass syntax check (`ruff check`)
- [ ] Adapter tests pass (`pytest tests/adapters/test_jira.py`)
- [ ] UI tests pass (`pytest tests/ui/`)

## Success Criteria

1. **Observable:** acli authentication check succeeds when user is authenticated
2. **Code Quality:** Consistent auth command used across adapter and detector
3. **Test Coverage:** Existing adapter tests continue to pass
4. **No Breaking Changes:** Only fixes the invalid command, doesn't change behavior

## Output

After completion, create: `.planning/phases/03-dashboard-ui/03-05-SUMMARY.md`
